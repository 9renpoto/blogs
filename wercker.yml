box: debian
build:
  steps:
    - install-packages:
        packages: openssh-client
    - add-ssh-key:
        keyname: BLOG_KEY
        host: github.com
    - add-to-known_hosts:
        hostname: github.com
        fingerprint: 16:27:ac:a5:76:28:2d:36:63:1b:56:4d:eb:df:a6:48
        type: rsa
    - script:
        name: install git
        code: |
            apt-get update --fix-missing
            apt-get install git -y
    - script:
        name: initialize git submodules
        code: |
            git submodule update --init --recursive
    - arjen/hugo-build:
        theme: delic
        flags: --buildDrafts=true
    - script:
        code: export NODE_ENV='testing'
  after-steps:
    - slack-notifier:
      url: $SLACK_URL
      channel: $SLACK_CHANNEL
      username: $SLACK_WERCKER_BOT_NAME
deploy:
  steps:
    - npm-install
    - script:
        name: offline
        code: $(npm bin)/gulp offline
    - script:
        name: deploy
        code: ./deploy.sh
  after-steps:
    - slack-notifier:
      url: $SLACK_URL
      channel: $SLACK_CHANNEL
      username: $SLACK_WERCKER_BOT_NAME
